Telegram-бот для автоматической обработки реестров YooKassa и подготовки данных для внесения в «Мой налог» (самозанятые).

Возможности
Автоматическая проверка почты (1 раз в сутки) и скачивание CSV-реестров
Парсинг реестров без pandas (только стандартный csv)
Подготовка данных для НПД: готовая строка для ручного внесения в «Мой налог»
Дедупликация: не обрабатывает одно письмо дважды
Безопасность: только разрешённые admin ID могут использовать бота
Long polling: не требует настройки webhook/nginx
Лёгкий: 1 контейнер, SQLite, минимум зависимостей
Быстрый старт
1. Создание Telegram-бота
Откройте @BotFather в Telegram
Отправьте /newbot
Следуйте инструкциям (имя бота, username)
Скопируйте токен (например: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz)
Узнайте свой Telegram ID:
Откройте @userinfobot
Скопируйте ваш ID (например: 123456789)
2. Настройка IMAP
Получите данные для доступа к почте:

Gmail: включите IMAP в настройках, создайте App Password
Yandex/Mail.ru: включите IMAP в настройках, используйте пароль от почты
Нужны:

IMAP_HOST (например: imap.gmail.com)
IMAP_PORT (обычно 993)
IMAP_USER (ваш email)
IMAP_PASSWORD (пароль или app-password)
3. Установка на сервер
Bash

# Создайте директорию проекта
mkdir -p /opt/yookassa-tax-bot
cd /opt/yookassa-tax-bot

# Скопируйте все файлы проекта (см. ниже)
# Создайте .env из .env.example
cp .env.example .env
nano .env  # Заполните все переменные

# Запустите
docker compose up -d

# Проверьте логи
docker compose logs -f
4. Использование
В Telegram напишите боту:

/start — приветствие
/run — вручную запустить проверку почты
/status — статистика обработки
Бот автоматически проверяет почту каждый день в указанное время (DAILY_HOUR:DAILY_MINUTE по TIMEZONE).

Структура данных
Бот отправляет сообщение с:

Датой реестра
Количеством платежей
Суммой дохода (для внесения в НПД)
Суммой комиссии (справочно)
Готовой строкой для копирования в «Мой налог»
И прикладывает 2 файла:

tax_ready_YYYY-MM-DD.csv — итоговая запись (дата, сумма, описание)
payments_YYYY-MM-DD.csv — детализация платежей